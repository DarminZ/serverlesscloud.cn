---
title: 天狮集团云函数实践：自定义业务逻辑实现跨境电商全球直播
description: 云函数x实时音视频 TRTC，在线视频转推。
date: 2021-10-11
thumbnail: https://main.qcloudimg.com/raw/97e4c554cd90b8c649027c978b58dcc9.jpg
categories:
  - best-practice
authors:
  - 刘传传
tags:
  - Serverless
  - 云函数
---



业务覆盖全球190多个国家和地区，服务全球用户超过4000万，业务领域横跨生物技术、健康管理、酒店旅游、教育培训、金融投资......运营这样一家跨国集团的全球化业务，需要在全球部署多少 IT 管理中心？

天狮集团作为这样一家跨国公司，给出的答案是：3个。



## 01. 一个 “小目标”：加速实现全球直播

天狮的全球化业务，主要由位于天津、北京和杭州的 3 个精简的 IT 团队负责，**积极通过技术创新提升业务开发效率**，源源不断地为天狮在全球输出业务动力。

2021 年，天狮将快速实现海内外直播服务提高为战略目标：

- 将直播运用到全球电商直播带货，覆盖全球逾 190 个海外市场；
- 将直播运用到内部培训、金牌讲师、教育宣讲等领域，服务于集团的全球化协同管理；

全球直播既关系到集团的全球销售利益，也影响到集团内部的跨国运营效率。

<img src="https://main.qcloudimg.com/raw/d2a4f04e15b5c6b2dff1ff45a9127fb0.png" width="700"/>

（天狮直播需求数据流）



天狮全球直播的特点与需求：

- **自定义业务逻辑**

集团内部全员大会的实时直播，需要使用专业设备推 中文、西班牙语、印尼语、俄语、法语、英语等多语言视频流， 且内容需要在全球 190 多个国家和地区进行直播和转播。

- **服务器成本**

全球不定期的电商运营活动，单独设立服务器的成本高，底层服务部署周期长。

- **并发不可控**

跨境电商的出口国家时区不同，对于集团总部在国内的公司来讲，难以根据全球时区进行 24 小时不间断的运维管理。

<img src="https://main.qcloudimg.com/raw/c4e0dae83eb20e4a5b2449ac3d677ec2.png" width="700"/>

（天狮 Serverless 云函数直播架构图）



## 02. 云函数在线视频转推

将主播的录播视频或者 RTMP 直播流推送到实时音视频 TRTC 房间进行直播，同时选择使用 Redis 开启推流直播的实时记录，由 API 网关将进度实时写入 Redis。天狮集团的完整直播流程包括直播推流、转码、录制、鉴黄、CDN 旁路加速等综合功能，通过腾讯云 Serverless 云函数远程调用函数服务快速构建，实现回放视频直播服务，缩短开发周期。



- 性能提升：1 秒可弹 1000+ 实例；
- 稳定性提升：可用性 99.99；
- 网络质量提升：全组件内网互访，延迟小于 5ms；
- 成本优化：引入云函数异步 Invoke API，节省消息队列费用；



云函数的可编程性，可以基于不同的编程语言（Python / Node / PHP / Java / Go），撰写**自定义业务逻辑**，整合其他云服务及第三方服务，**扩展业务边界，高效创新玩法**。在天狮全球直播服务中，通过腾讯云 TRTC 音视频服务、SCF 云函数、IM 即时通讯、VOD 云直播、云存储等相关服务，整合对接第三方的实时语音识别和 AI 文本翻译，实现海外直播字幕翻译功能，解决全球电商直播带货、全球会议转播和实时互动的需求，达成集团战略目标。

<img src="https://main.qcloudimg.com/raw/2d55303d3c2d07d094eac9e63f1abc16.png" width="700"/>

（天狮全球会议、电商直播 业务实现效果图）



**自定义业务逻辑**

对接第三方的实时语音识别和 AI 文本翻译，实现海外直播多语种字幕的翻译功能。

**主播端**

专业设备推流，一路视频流同时满足多个 App 直播互动；针对电商的销售属性，主播端保障商品上架、互动连麦等助销功能使用顺畅。

**海量并发处理**

每秒最高支持10万并发请求数，面对直播过程中不可控的突发流量，高并发承载能力稳定支撑密集的业务峰值。

**流媒体处理**

采用流式拉取源视频文件，流式上传转码文件的工作方式，搭配对象存储，一键构建自动化转码流程；直播过程中，对直播内容进行录制截图以满足回播和违规内容审查需求。



**“持续保持技术创新，用技术赋能市场，以更快更好的项目交付成果达成集团战略目标。”**

**——天狮集团高级经理 鱼箴。**



## 03. 电商业务中云函数典型应用场景

**1. 电商直播等 CPU 密集型业务**

直播带货已成为线上电商平台的标配功能。电商直播中，需要专业、稳定的直播推流、转码、分发、播放等服务，满足超低延迟、超高画质、超大并发访问量的要求。在直播结束后，通常需要对回播视频进行处理，例如音视频转码和混流、回播视频二次分发和存储等。相较于自建转码服务器，云函数 SCF 无需考虑转码服务器闲置时间的利用效率、以及服务器运维等问题。

<img src="https://main.qcloudimg.com/raw/63223e71b3faa845afa7394d081a422b.png" width="700"/>

（云函数电商直播方案）



- **平滑迁移快速上线**

支持用户自定义配置 FFmpeg 命令参数、以及部署自建 FFmpeg，转码方式灵活，也可以便捷地从物理机、云主机或容器中移植到云函数。

- **解决算力瓶颈**

大规格实例最高支持 128GB/64C 进行 4K 高清视频转码，结合资源弹性伸缩能力，有效保证转码效率。

- **按量计费成本优势**

视频转码是高运算负荷的 CPU 密集型业务，需要对输入的视频流进行全解码、视频过滤/图像处理、并对输出格式进行全编码。云函数的 1 毫秒粒度按用量计费，拥有显著的成本优势。



**2. 电商大促等波峰波谷型业务**

每年双11、618等电商大促期间，电商行业线上渠道面临历史级别的流量挑战，中大型电商平台的峰值调用量可达上千万 / 分钟，面临高于日常10至20倍的流量压力；日常运营活动中，例如精品秒杀、限时抢购等，电商平台也同样面临大流量高并发、波峰波谷用户流量明显分化的典型场景。云函数 SCF 提供弹性、可扩展的基础设施和护航服务，帮助电商客户把握业务增长的机遇，从容应对挑战。

<img src="https://main.qcloudimg.com/raw/9c7e00b2316b28fa9d62f2dcdb05ef4a.png" width="700"/>

（电商弹性大促架构图）



- **瞬时冷启动**

云函数 SCF 底层采用自研的轻量级虚拟化技术，Micro Vm 启动时间短至 90 毫秒，函数**冷启动减低至 200 毫**秒，并且支持上万台计算节点同时扩容。

- **实时扩缩容**

基于函数请求实时计算的模式，动态的扩缩函数实例，优化函数冷启动的体验问题，以及控制函数计算的资源成本 。

- **预置并发**

在秒杀、抢购等场景中，瞬间需要海量的计算资源。云函数预置并发，可支持并发实例按配置预先启动，提前 “预热” 函数，为业务高峰提前准备计算资源，消除冷启动、降低运行环境初始化及业务代码初始化引起的耗时。



**3. 智能图片处理等事件驱动型业务**

在电商平台上，每天都会有大量商品图片的查询请求和更新请求。高峰情况下，每天有千万级甚至亿级的图片处理需求。云函数 SCF 提供图片裁剪、增加水印等多种处理能力，满足电商业务的图片处理诉求。同时针对图片处理、存储的高可用要求，可以支持对象存储的跨区域高可用部署。



传统方案需要搭建一个在线服务器并部署 Web 应用来进行图片处理，程序按照一定规则定时触发事件。在传统方案中，主要有三个困扰：没有请求时，空置率较高；需要专门维护一套运行处理代码；需要考虑并发和定时器的执行方法，来保障图片处理的及时性。



而在 Serverless 架构中，用户仅需要在云函数 SCF 上设置触发器+函数，当用户把图片上传到对象存储中，将会触发函数代码进行图片处理，并把图片转移到新的存储桶中。整个过程，不需要搭建 Web 服务器，无需编写触发条件，也无需关注业务运维。

<img src="https://main.qcloudimg.com/raw/ceeb9c03a30682f2e228b2f45eb70151.png" width="700"/>

（云函数图像处理方案）



------

### 腾讯云云函数专享服务申请

腾讯云云函数已孵化诸多较为成熟的解决方案，[**点击完成信息填写**](https://wj.qq.com/s2/9144427/1d8b/)，我们将为您提供 1v1 业务技术交流，提供更加适合的解决方案。



> **传送门：**
>
> - GitHub: [github.com/serverless](https://github.com/serverless/serverless/blob/master/README_CN.md)
> - 官网：[serverless.com](https://serverless.com/)

欢迎访问：[Serverless 中文网](https://serverlesscloud.cn/)，您可以在 [最佳实践](https://serverlesscloud.cn/best-practice) 里体验更多关于 Serverless 应用的开发！









